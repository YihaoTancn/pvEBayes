<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a general-gamma, GPS, K-gamma, KM or efron model for a contingency table. — pvEBayes • pvEBayes</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a general-gamma, GPS, K-gamma, KM or efron model for a contingency table. — pvEBayes"><meta name="description" content='This function fits a non-parametric empirical Bayes model to an AE-drug
contingency table using one of several empirical Bayes approaches with
specified hyperparameter, if is required. Supported models include the
"general-gamma", "GPS", "K-gamma", "KM", and "efron".'><meta property="og:description" content='This function fits a non-parametric empirical Bayes model to an AE-drug
contingency table using one of several empirical Bayes approaches with
specified hyperparameter, if is required. Supported models include the
"general-gamma", "GPS", "K-gamma", "KM", and "efron".'></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pvEBayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/pvEBayes-introduction.html">Analyzing SRS frequency table with pvEBayes</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/YihaoTancn/pvEBayes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Fit a general-gamma, GPS, K-gamma, KM or efron model for a contingency table.</h1>
      <small class="dont-index">Source: <a href="https://github.com/YihaoTancn/pvEBayes/blob/main/R/pvEBayes_main_function.R" class="external-link"><code>R/pvEBayes_main_function.R</code></a></small>
      <div class="d-none name"><code>pvEBayes.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function fits a non-parametric empirical Bayes model to an AE-drug
contingency table using one of several empirical Bayes approaches with
specified hyperparameter, if is required. Supported models include the
"general-gamma", "GPS", "K-gamma", "KM", and "efron".</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pvEBayes</span><span class="op">(</span></span>
<span>  <span class="va">contin_table</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"general-gamma"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  K <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  p <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  c0 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  maxi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  eps <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  n_posterior_draws <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  E <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-contin-table">contin_table<a class="anchor" aria-label="anchor" href="#arg-contin-table"></a></dt>
<dd><p>an IxJ contingency table showing pairwise counts of
adverse events for I AEs (along the rows) and J drugs (along the columns).</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>the model to fit. Available models are "general-gamma",
"K-gamma", "GPS", "KM" and "efron". Default to "general-gamma".</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>numeric between 0 and 1. The hyperparameter of "general-gamma"
model. It is needed if "general-gamma" model is used.</p></dd>


<dt id="arg-k">K<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>integer greater than or equal to 2. It is needed if "K-gamma" model
is used.</p></dd>


<dt id="arg-p">p<a class="anchor" aria-label="anchor" href="#arg-p"></a></dt>
<dd><p>integer greater than or equal to 2. It is needed if "efron" mode is
used.</p></dd>


<dt id="arg-c-">c0<a class="anchor" aria-label="anchor" href="#arg-c-"></a></dt>
<dd><p>numeric and greater than 0. It is needed if "efron" mode is used.</p></dd>


<dt id="arg-maxi">maxi<a class="anchor" aria-label="anchor" href="#arg-maxi"></a></dt>
<dd><p>upper limit of iteration for the ECM algorithm.</p></dd>


<dt id="arg-eps">eps<a class="anchor" aria-label="anchor" href="#arg-eps"></a></dt>
<dd><p>a tolerance parameter used in the stopping rule of the ECM
algorithm. If the difference in marginal likelihood between two consecutive
iterations is less than eps, the ECM algorithm stops. Default to be 1e-4.</p></dd>


<dt id="arg-n-posterior-draws">n_posterior_draws<a class="anchor" aria-label="anchor" href="#arg-n-posterior-draws"></a></dt>
<dd><p>number of posterior draws for each AE-drug
combination.</p></dd>


<dt id="arg-e">E<a class="anchor" aria-label="anchor" href="#arg-e"></a></dt>
<dd><p>A matrix of expected counts under the null model for the SRS
frequency table. If <code>NULL</code> (default), the expected counts are estimated
from the SRS data using 'estimate_null_expected_count()'.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns an S3 object of class <code>pvEBayes</code> containing the
estimated model parameters as well as posterior draws for each AE-drug
combination if the number of posterior draws is specified.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function implements the ECM algorithm proposed by Tan et al. (2025),
providing a stable and efficient implementation of Gamma-Poisson
Shrinker(GPS), K-gamma and "general-gamma" methods for signal estimation and
signal detection in Spontaneous Reporting System (SRS) data table.</p>
<p>Method "GPS" is proposed by DuMouchel (1999) and it is a parametric empirical
Bayes model with a two gamma mixture prior distribution.</p>
<p>Methods "K-gamma" and "general-gamma" are non-parametric empirical Bayes
models, introduced by Tan et al. (2025). The number of mixture components "K"
needs to be prespecified when fitting a "K-gamma" model. For "general-gamma",
the mixture weights are regularized by a Dirichlet hyper prior with
hyperparameter \(0 \leq \alpha &lt; 1\) that controls the shrinkage strength.
As "alpha" approaches 0, less non-empty mixture components exist in the
fitted model. When \(\alpha = 0\), the Dirichlet distribution is an
improper prior still offering a reasonable posterior inference that
represents the strongest shrinkage of the "general-gamma" model.</p>
<p>Parameter estimation for the "KM" model is formulated as a convex
optimization problem. The objective function and constraints follow the same
construction as in <span class="pkg">REBayes</span>. Parameter estimation is performed using
the open-source convex optimization package <span class="pkg">CVXR</span>.</p>
<p>The implementation of the "efron" model in this package is adapted from the
<span class="pkg">deconvolveR</span> package, developed by Bradley Efron and
Balasubramanian Narasimhan. The original implementation in <span class="pkg">deconvolveR</span>
does not support an exposure or offset parameter in the Poisson model,
which corresponds to the expected null value (\(E_{ij}\)) for each AE-drug
combination. To address this, we modified the relevant code to allow for the
inclusion of \(E_{ij}\) in the Poisson likelihood. In addition, we
implemented a method for estimating the degrees of freedom, enabling AIC- or
BIC-based hyperparameter selection for the "efron" model (Tan et al. 2025).
See <code><a href="pvEBayes_tune.html">pvEBayes_tune</a></code> for details.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>DuMouchel W. Bayesian data mining in large frequency tables, with an
application to the FDA spontaneous reporting system.
<em>The American Statistician.</em> 1999; 1;53(3):177-90. <br></p>
<p>Tan Y, Markatou M and Chakraborty S. Flexible Empirical Bayesian Approaches
to Pharmacovigilance for Simultaneous Signal Detection and Signal Strength
Estimation in Spontaneous Reporting Systems Data.
<em>Statistics in Medicine.</em> 2025; 44: 18-19,
https://doi.org/10.1002/sim.70195.</p>
<p>Narasimhan B, Efron B. deconvolveR: A G-modeling program for deconvolution
and empirical Bayes estimation. <em>Journal of Statistical Software</em>.
2020; 2;94:1-20.</p>
<p>Koenker R, Gu J. REBayes: an R package for empirical Bayes mixture methods.
<em>Journal of Statistical Software</em>. 2017; 4;82:1-26.</p>
<p>Fu, A, Narasimhan, B, Boyd, S. CVXR: An R Package for Disciplined Convex
Optimization. <em>Journal of Statistical Software</em>. 2020; 94;14:1-34.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ref_table</span> <span class="op">&lt;-</span> <span class="va">statin2025_44</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set up signal matrix with one signal at entry (1,1)</span></span></span>
<span class="r-in"><span><span class="va">sig_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ref_table</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ref_table</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sig_mat</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set up structural zero matrix</span></span></span>
<span class="r-in"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">ref_table</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">ref_table</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Z</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">simu_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_contin_table.html">generate_contin_table</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  ref_table <span class="op">=</span> <span class="va">ref_table</span>,</span></span>
<span class="r-in"><span>  signal_mat <span class="op">=</span> <span class="va">sig_mat</span>,</span></span>
<span class="r-in"><span>  n_table <span class="op">=</span> <span class="fl">1</span>,</span></span>
<span class="r-in"><span>  Variation <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>  zi_indic_mat <span class="op">=</span> <span class="va">Z</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fit general-gamma model with a specified alpha</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">pvEBayes</span><span class="op">(</span></span></span>
<span class="r-in"><span>  contin_table <span class="op">=</span> <span class="va">simu_table</span>, model <span class="op">=</span> <span class="st">"general-gamma"</span>,</span></span>
<span class="r-in"><span>  alpha <span class="op">=</span> <span class="fl">0.3</span>, n_posterior_draws <span class="op">=</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yihao Tan, Marianthi Markatou, Saptarshi Chakraborty, Raktim Mukhopadhyay.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>


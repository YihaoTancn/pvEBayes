<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to pvEBayes • pvEBayes</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to pvEBayes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pvEBayes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pvEBayes-introduction.html">Introduction to pvEBayes</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/YihaoTancn/pvEBayes/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to pvEBayes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/YihaoTancn/pvEBayes/blob/main/vignettes/pvEBayes-introduction.Rmd" class="external-link"><code>vignettes/pvEBayes-introduction.Rmd</code></a></small>
      <div class="d-none name"><code>pvEBayes-introduction.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="disproportionality-analysis">Disproportionality Analysis<a class="anchor" aria-label="anchor" href="#disproportionality-analysis"></a>
</h3>
<p>Contemporary drug postmarketing surveillance largely relies on the
collection of spontaneous reports of suspected adverse drug events from
pharmaceutical companies, healthcare professionals, and patients. These
reports are curated and stored in spontaneous reporting systems (SRS),
usually organized as a large frequency table for downstream data
analysis. We consider an SRS dataset cataloging AE reports on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>I</mi><annotation encoding="application/x-tex">I</annotation></semantics></math>
AE rows across
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>J</mi><annotation encoding="application/x-tex">J</annotation></semantics></math>
drug columns. Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">N_{ij}</annotation></semantics></math>
denote the number of reported cases for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>-th
AE and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>-th
drug, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>I</mi></mrow><annotation encoding="application/x-tex">i = 1,..., I</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">j = 1,..., J</annotation></semantics></math>.
Therefore, AE-drug pairwise occurrences from the AE-reports are
summarized into an
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mo>×</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">I \times J</annotation></semantics></math>
contingency table, where the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(i,j)</annotation></semantics></math>-th
cell catalogs the observed count
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">N_{ij}</annotation></semantics></math>
indicating the number of cases involving
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>-th
AE and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>-th
drug.</p>
<p>Current disproportionality analysis mainly focuses on <em>signal
detection</em> which seeks to determine whether the observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">N_{ij}</annotation></semantics></math>
is substantially greater than the corresponding null baseline
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">E_{ij}</annotation></semantics></math>.
Or equivalently, its signal strength
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{ij}</annotation></semantics></math>
is significantly greater than 1.</p>
<p>In addition to <em>signal detection</em>, Tan et al. (<em>Stat. in
Med.</em>, 2025) broaden the role of disproportionality to <em>signal
strength estimation</em>. The use of the flexible non-parametric
empirical Bayes models enables more nuanced empirical Bayes posterior
inference (signal strength
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
estimation and uncertainty quantification). This allows researchers to
distinguish AE-drug pairs that would appear similar under a binary
signal detection framework. For example, the AE-drug pairs with signal
strengths of 1.5 and 4.0 could both be significantly greater than 1 and
detected as a signal. Such differences in signal strength may have
distinct implications in medical and clinical contexts.</p>
<p>Methods implemented in this package assumes the observed count
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">N_{ij}</annotation></semantics></math>
conditional on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">E_{ij}</annotation></semantics></math>
is that
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∣</mo><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∼</mo><mo>Poisson</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="0.222em"></mspace><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mi>…</mi><mo>,</mo></mrow><annotation encoding="application/x-tex">\begin{equation} \label{eqn:model-poisson-likelihood}
N_{ij} \mid E_{ij} \sim \operatorname{Poisson}(E_{ij}\lambda_{ij}), \ N_{ij} = 0, 1, 2 \dots,  
\end{equation}</annotation></semantics></math> where the parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\lambda_{ij} \geq 0</annotation></semantics></math>
is the relative reporting ratio, the signal strength, for the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>,</mo><mi>j</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(i, j)</annotation></semantics></math>-th
pair measuring the ratio of the actual expected count arising due to
dependence to the null baseline expected count. Therefore,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\lambda_{ij}\}</annotation></semantics></math>
are our key parameters of interest. A large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">\lambda_{ij}</annotation></semantics></math>
indicates a strong association between a drug and an AE.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
be a prior density function for signal strength parameters for all
AE-drug pairs:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∼</mo><mi>g</mi></mrow><annotation encoding="application/x-tex">\lambda_{ij} \sim g</annotation></semantics></math>.
Then, in the context of the Poisson model, the marginal probability mass
function of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">N_{ij}</annotation></semantics></math>
is given by:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>∞</mi></msubsup><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.222em"></mspace><msub><mi>f</mi><mtext mathvariant="normal">pois</mtext></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∣</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.222em"></mspace><mi>d</mi><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
p(N_{ij}) = \int_0^{\infty} g(\lambda_{ij}) \ f_{\text{pois}}(N_{ij} \mid \lambda_{ij}E_{ij}) \ d\lambda_{ij},
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mtext mathvariant="normal">pois</mtext></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo>∣</mo><mi>λ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_{\text{pois}}(N \mid \lambda)</annotation></semantics></math>
is the probability mass function of a Poisson random variable with mean
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
evaluated at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>.
Under the empirical Bayes framework, the prior distribution is
consequently estimated from the data by maximizing the log marginal
likelihood:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>g</mi><mo accent="true">̂</mo></mover><mo>=</mo><munder><mo>argmax</mo><mi>g</mi></munder><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>I</mi></munderover><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>J</mi></munderover><mo>log</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\hat g = \mathop{\arg \max}\limits_{g} \sum_{i=1}^I \sum_{j=1}^J \log p(N_{ij}).
</annotation></semantics></math> Then, the estimated empirical Bayes
posterior density of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
given
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">N_{ij}</annotation></semantics></math>
is:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mtext mathvariant="normal">p</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mo>∣</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mfrac><mrow><mover><mi>g</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>f</mi><mtext mathvariant="normal">pois</mtext></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∣</mo><mi>λ</mi><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mover><mtext mathvariant="normal">p</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo>,</mo><mspace width="0.222em"></mspace><mi>λ</mi><mo>&gt;</mo><mn>0</mn><mo>,</mo></mrow><annotation encoding="application/x-tex">
\hat{\text{p}}(\lambda \mid N_{ij}) = \frac{\hat g(\lambda) f_{\text{pois}}(N_{ij} \mid \lambda E_{ij})}{\hat{\text{p}}(N_{ij})}, \ \lambda &gt; 0,
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mtext mathvariant="normal">p</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∫</mo><mn>0</mn><mi>∞</mi></msubsup><mover><mi>g</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><msub><mi>f</mi><mtext mathvariant="normal">pois</mtext></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>∣</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.222em"></mspace><mi>d</mi><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub></mrow><annotation encoding="application/x-tex">\hat{\text{p}}(N_{ij}) = \int_0^{\infty} \hat g(\lambda_{ij})f_{\text{pois}}(N_{ij}\mid \lambda_{ij}E_{ij}) \ d\lambda_{ij}</annotation></semantics></math>.</p>
<p>All empirical Bayes models implemented in ‘pvEBayes’ share the
structure described above; they differ by their assumptions on the prior
distribution. Implemented methods include the Gamma-Poisson Shrinker
(GPS), Koenker-Mizera (KM) method, Efron’s nonparametric empirical Bayes
approach, the K-gamma model, and the general-gamma model. The selection
of the prior distribution is critical in Bayesian analysis. The GPS
model uses a gamma mixture prior by assuming the signal/non-signal
structure in SRS data. However, in real-world setting, signal strengths
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">{(\lambda_{ij})}</annotation></semantics></math>
are often heterogeneous and thus follows a multi-modal distribution,
making it difficult to assume a parametric prior. Non-parametric
empirical Bayes models (KM, Efron, K-gamma and general-gamma) address
this challenge by utilizing a flexible prior with a general mixture form
and estimating the prior distribution in a data-driven way.</p>
<p>The KM method has an existing implementation in the
<code>REBayes</code> package, but it relies on Mosek, a commercial
convex optimization solver, which may limit accessibility due to
licensing issues. The <code>pvEBayes</code> package provides an
alternative fully open-source implementation of the KM method using
<code>CVXR</code>. Efron’s method also has a general nonparametric
empirical Bayes implementation in the <code>deconvolveR</code> package;
however, that implementation does not support an exposure or offset
parameter in the Poisson model, which corresponds to the expected null
value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">{E_{ij}}</annotation></semantics></math>.
In <code>pvEBayes</code>, the implementation of Efron’s method is
adapted and modified from <code>deconvolveR</code> to support
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>E</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">{E_{ij}}</annotation></semantics></math>
in the Poisson model. In addition, this package implements the novel
bi-level Expectation Conditional Maximization (ECM) algorithm proposed
by Tan et al. (2025) for efficient parameter estimation in gamma mixture
prior based models mentioned above.</p>
<p>Package ‘pvEBayes’ provides a suite of streamlined tools for
effectively fitting these models to the spontaneous reporting system
(SRS) frequency tables, extracting summaries, performing hyperparameter
tuning, and generating graphical summaries (eye plots and heatmaps) for
signal detection and estimation. In the following we provide an example,
borrowed from Tan et al. (<em>arxiv</em>, 2025), of SRS data analyzing
with ‘pvEBayes’.</p>
</div>
<div class="section level3">
<h3 id="analyzing-fda-statin-srs-data-with-pvebayes">Analyzing FDA statin SRS data with pvEBayes<a class="anchor" aria-label="anchor" href="#analyzing-fda-statin-srs-data-with-pvebayes"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/YihaoTancn/pvEBayes" class="external-link">pvEBayes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co"># load the SRS data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"statin2025_44"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show the first 6 rows</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">statin2025_44</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                        Atorvastatin Fluvastatin Lovastatin</span></span>
<span><span class="co">#&gt; ACUTE KIDNEY INJURY                            1132          23         23</span></span>
<span><span class="co">#&gt; ANURIA                                           46           0          0</span></span>
<span><span class="co">#&gt; BLOOD CALCIUM DECREASED                          51           2          0</span></span>
<span><span class="co">#&gt; BLOOD CREATINE PHOSPHOKINASE ABNORMAL            19           0          0</span></span>
<span><span class="co">#&gt; BLOOD CREATINE PHOSPHOKINASE INCREASED          624          21          4</span></span>
<span><span class="co">#&gt; BLOOD CREATININE ABNORMAL                        11           0          0</span></span>
<span><span class="co">#&gt;                                        Pravastatin Rosuvastatin Simvastatin</span></span>
<span><span class="co">#&gt; ACUTE KIDNEY INJURY                            153         1141         453</span></span>
<span><span class="co">#&gt; ANURIA                                           1           56          29</span></span>
<span><span class="co">#&gt; BLOOD CALCIUM DECREASED                          3          877           6</span></span>
<span><span class="co">#&gt; BLOOD CREATINE PHOSPHOKINASE ABNORMAL            0           11           1</span></span>
<span><span class="co">#&gt; BLOOD CREATINE PHOSPHOKINASE INCREASED          41          557         216</span></span>
<span><span class="co">#&gt; BLOOD CREATININE ABNORMAL                        0           32           6</span></span>
<span><span class="co">#&gt;                                        Other_drugs</span></span>
<span><span class="co">#&gt; ACUTE KIDNEY INJURY                         192114</span></span>
<span><span class="co">#&gt; ANURIA                                        7079</span></span>
<span><span class="co">#&gt; BLOOD CALCIUM DECREASED                      33175</span></span>
<span><span class="co">#&gt; BLOOD CREATINE PHOSPHOKINASE ABNORMAL          133</span></span>
<span><span class="co">#&gt; BLOOD CREATINE PHOSPHOKINASE INCREASED       17203</span></span>
<span><span class="co">#&gt; BLOOD CREATININE ABNORMAL                     2645</span></span></code></pre></div>
<div class="section level4">
<h4 id="fit-the-general-gamma-model">Fit the general-gamma model<a class="anchor" aria-label="anchor" href="#fit-the-general-gamma-model"></a>
</h4>
<p>Our interest lies in finding the most important adverse events and
estimating the corresponding signal strength of these 6 statin drugs.
These are achieved by fitting empirical Bayes models with pvEBayes() to
the SRS data. We begin by fitting the general-gamma model to this
dataset. Other models mentioned above could be used by modifying the
‘model’ argument. For illustration, we fit the model with a fixed
hyperparameter value of $ = 0.5$ using the pvEBayes() function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_given_alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pvEBayes.html">pvEBayes</a></span><span class="op">(</span><span class="va">statin2025_44</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"general-gamma"</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_given_alpha_detected_signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gg_given_alpha</span>,</span>
<span>  return <span class="op">=</span> <span class="st">"detected signal"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">gg_given_alpha_detected_signal</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 105</span></span></code></pre></div>
<p>The return argument specifies which component the summary function
should return. Valid options include: “prior parameters”, “likelihood”,
“detected signal”, and “posterior draws”. If it is set to NULL
(default), all components will be returned in a list. In this example,
we show the detected signals.</p>
<p>In this package, we suggest tuning the general-gamma model by AIC or
BIC, which can be accessed through ‘AIC()’ or ‘BIC()’ functions, as
shown below:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">gg_given_alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3796.813</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">BIC</a></span><span class="op">(</span><span class="va">gg_given_alpha</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3999.452</span></span></code></pre></div>
<p>In practice, one can specify a list of candidate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
values, fit the general-gamma model for each, compute the corresponding
AIC or BIC, and select the model with the lowest AIC or BIC. Instead of
manually doing so, one can use the ‘pvEBayes_tune()’ function, which
implements these steps. The relevant code is given below:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_tune_statin44</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pvEBayes_tune.html">pvEBayes_tune</a></span><span class="op">(</span><span class="va">statin2025_44</span>,</span>
<span>  model <span class="op">=</span> <span class="st">"general-gamma"</span>,</span>
<span>  alpha_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span>, <span class="fl">0.9</span><span class="op">)</span>,</span>
<span>  use_AIC <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; The alpha value selected under AIC is 0.5,</span></span>
<span><span class="co">#&gt; The alpha value selected under BIC is 0.</span></span>
<span><span class="co">#&gt;   alpha      AIC      BIC num_mixture</span></span>
<span><span class="co">#&gt; 1   0.0 3803.082 3960.690          14</span></span>
<span><span class="co">#&gt; 2   0.1 3799.012 3990.393          17</span></span>
<span><span class="co">#&gt; 3   0.3 3798.874 4001.513          18</span></span>
<span><span class="co">#&gt; 4   0.5 3796.813 3999.452          18</span></span>
<span><span class="co">#&gt; 5   0.7 3824.280 4083.208          23</span></span>
<span><span class="co">#&gt; 6   0.9 3912.529 4340.322          38</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualization">Visualization<a class="anchor" aria-label="anchor" href="#visualization"></a>
</h3>
<p>In addition, ‘pvEBayes’ has implemented visual summary methods for
both signal detection and estimation, which are heatmap and eyeplot.
These plot functions can be accessed through the ‘plot()’ with argument
type = “heatmap” or type = “eyeplot”.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">heatmap_gg_tune_statin44</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_tune_statin44</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"heatmap"</span>,</span>
<span>  num_top_AEs <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  cutoff_signal <span class="op">=</span> <span class="fl">1.001</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">heatmap_gg_tune_statin44</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="pvEBayes-introduction_files/figure-html/heatmap-1.png" class="r-plt" alt="" width="768"></p>
<p>The above heatmap visualizes the signal detection result for the
fitted general-gamma model. For each AE-drug combination, the number of
reports (N), the estimated null value (E), and the estimated empirical
Bayes posterior probability of being a signal are given. A deeper blue
color indicates stronger evidence for a signal.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eyeplot_gg_tune_statin44</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gg_tune_statin44</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"eyeplot"</span>,</span>
<span>  num_top_AEs <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  N_threshold <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  log_scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  text_shift <span class="op">=</span> <span class="fl">2.3</span>,</span>
<span>  text_size <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  x_lim_scalar <span class="op">=</span> <span class="fl">1.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">eyeplot_gg_tune_statin44</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="pvEBayes-introduction_files/figure-html/eyeplot-1.png" class="r-plt" alt="" width="768"></p>
<p>The above eyeplot visualizes empirical posterior inferences on 10
prominent AEs across 6 statin drugs through computed empirical Bayesian
posterior distributions of signal strengths
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\lambda_{ij}\}</annotation></semantics></math>
obtained from the general-gamma model fitted on the statin2025_44
dataset. The points and bars represent the posterior medians and 90%
equi-tailed credible intervals for the corresponding AE-drug pair
specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>λ</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{\lambda_{ij}\}</annotation></semantics></math>,
with different colors indicating the results from different statin
drugs. The red dotted vertical line represents the value ‘1’. The texts
on the right provide the number of observations as well as the null
baseline expected counts under independence for an AE-drug pair.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Tan Y, Markatou M and Chakraborty S. Flexible Empirical Bayesian
Approaches to Pharmacovigilance for Simultaneous Signal Detection and
Signal Strength Estimation in Spontaneous Reporting Systems Data.
<em>Statistics in Medicine</em>. 2025; 44: 18-19, <a href="https://doi.org/10.1002/sim.70195" class="external-link uri">https://doi.org/10.1002/sim.70195</a>.</p>
<p>Tan Y, Markatou M and Chakraborty S. pvEBayes: An R Package for
Empirical Bayes Methods in Pharmacovigilance. <em>arXiv</em>:2512.01057
(stat.AP). <a href="https://doi.org/10.48550/arXiv.2512.01057" class="external-link uri">https://doi.org/10.48550/arXiv.2512.01057</a></p>
<p>Koenker R, Mizera I. Convex Optimization, Shape Constraints, Compound
Decisions, and Empirical Bayes Rules. <em>Journal of the American
Statistical Association</em> 2014; 109(506): 674–685, <a href="https://doi.org/10.1080/01621459.2013.869224" class="external-link uri">https://doi.org/10.1080/01621459.2013.869224</a></p>
<p>Efron B. Empirical Bayes Deconvolution Estimates. <em>Biometrika</em>
2016; 103(1); 1-20, <a href="https://doi.org/10.1093/biomet/asv068" class="external-link uri">https://doi.org/10.1093/biomet/asv068</a></p>
<p>DuMouchel W. Bayesian data mining in large frequency tables, with an
application to the FDA spontaneous reporting system. <em>The American
Statistician</em>. 1999; 1;53(3):177-90.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yihao Tan, Marianthi Markatou, Saptarshi Chakraborty, Raktim Mukhopadhyay.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
